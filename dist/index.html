<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="app.js"></script>
</head>
<body>
<script></script>
<div id="app"></div>
<script>
    let app = Elm.Pokertool.init({
        flags: new URLSearchParams(window.location.search).get("id"),
        node: document.getElementById('app')
    });

    // Inform app of browser navigation (the BACK and FORWARD buttons)
    // window.addEventListener('popstate', function () {
    //     app.ports.onUrlChange.send(location.href);
    // });

    // Change the URL upon request, inform app of the change.
    // app.ports.pushUrl.subscribe(function(url) {
    //     history.pushState({}, '', url);
    //     app.ports.onUrlChange.send(location.href);
    // });

    // When a command goes to the `sendMessage` port, we pass the message
    // along to the WebSocket.
    app.ports.openWebsocket.subscribe(function (roomId) {
        let socket = new WebSocket("wss://w78h9mubp4.execute-api.eu-west-1.amazonaws.com/Prod")
        socket.addEventListener("open", function (event) {
            console.log("OPEN!!")
            socket.send(JSON.stringify({action: "sendmessage", payload: {type: "join", roomId: roomId}}))
            console.log("Message sent!")
        })

        socket.addEventListener("message", function (event) {
            console.log("Message received: ")
            console.log(event)
            //app.ports.roomUpdate.send("message received!")
        })
    });
</script>
</body>
</html>
